{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "WebsocketController",
        "stores": [
            "UserStore"
        ]
    },
    "designerId": "c2cb7d69-97f9-45f6-b258-35fa74fcf117",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onLaunch",
                "implHandler": [
                    "ws = new WebSocket('ws://10.50.24.156:8000');\r",
                    "var wsconnections = {};\r",
                    "ws.onmessage = function(data){\r",
                    "    data = Ext.JSON.decode(data.data);\r",
                    "    switch(data.action){\r",
                    "        case 'notification':\r",
                    "            var userList = Ext.ComponentQuery.query('#userList')[0];\r",
                    "            var selectedUsers = userList.getSelectionModel().getSelection();\r",
                    "            if(selectedUsers.length === 1){\r",
                    "                var user = selectedUsers[0];\r",
                    "                if(user.data.user === data.user){\r",
                    "                    var userStore = Ext.getStore('MessageStore');\r",
                    "                    userStore.add({'content':Ext.JSON.encode(data)});\r",
                    "                }\r",
                    "            }\r",
                    "            break;\r",
                    "        case 'connection':\r",
                    "            if(Ext.isEmpty(wsconnections[data.user])){\r",
                    "                Ext.getStore('UserStore').add({'user': data.user});\r",
                    "                wsconnections[data.user] = true;\r",
                    "            }\r",
                    "            break;\r",
                    "    }\r",
                    "};\r",
                    "ws.onopen = function() {\r",
                    "\r",
                    "    var message ={\r",
                    "        action: 'monitor'\r",
                    "    };\r",
                    "    ws.send(JSON.stringify(message));\r",
                    "};"
                ]
            },
            "designerId": "3ded55da-3eb7-4b59-af31-2978256e6cec"
        }
    ]
}